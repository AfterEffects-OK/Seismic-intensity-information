# 地震情報トラッカー 詳細使用方法・仕様書

## 1. 概要

このWebアプリケーションは、P2P地震情報APIから直近の**最大震度3以上**の地震情報を取得し、一覧表示および詳細表示を行うためのツールです。

特に、YouTubeなどのライブ配信画面での利用を想定しており、クロマキー合成に対応した**画面下部の固定情報バー**と、その表示を制御する高度な**自動ページ送り機能**を搭載しています。

---

## 2. 詳細な使用方法

### 2.1. 画面構成

本アプリケーションは、大きく3つのエリアで構成されています。

  <!-- 画像URLを挿入する場合はここに -->

**A. 地震一覧パネル（画面左）**
- **機能**: 最新の地震情報がリスト形式で表示されます。
- **操作**:
    - **リスト項目**: クリックすると、その地震の詳細が「B. 地震詳細パネル」と「C. 固定情報バー」に読み込まれます。
    - **API更新ボタン**: 手動でAPIから最新の地震情報を取得します。
    - **市区町村別/観測点別トグル**: 詳細パネルに表示される地域情報の粒度を切り替えます。

**B. 地震詳細パネル（画面右）**
- **機能**: 選択した地震の詳しい情報が表示されます。
- **表示項目**:
    - 震源地、発生日時、マグニチュード、震源の深さ、津波の有無
    - 最大震度
    - 各震度を観測した地域の一覧（トグルの設定に応じて市区町村別または観測点別）

**C. 固定情報バー（画面下部）**
- **機能**: ライブ配信での使用を想定した情報表示エリアです。

    **C-1. 操作パネル（左側・ダーク背景）**
    - **自動ページ送り設定**:
        - **再生/一時停止ボタン (▶/❚❚)**: 自動ページ送りを開始・停止します。
        - **秒数設定**: 各ページを表示する秒数を設定します。（デフォルト: 10秒）
        - **ループ回数設定**: 自動送りのループ回数を1〜10回、または無限（∞）から選択します。（デフォルト: 3回）
    - **ページナビゲーション**:
        - **< / > ボタン**: 手動でページを前後に送ります。（自動再生中は無効）
        - **ページ情報**: `現在のページ/総ページ数` と、再生中には `L:現在のループ/総ループ数` が表示されます。
    - **表示効果設定**:
        - **カット/スライド ドロップダウン**: ページの切り替え効果を選択します。
        - **リセットボタン**: 表示を初期状態（グリーンバックのみ）に戻します。

    **C-2. 情報表示エリア（右側・グリーンバック）**
    - **機能**: この緑色のエリアを配信ソフトのクロマキーで透過させることで、ゲーム画面などに情報を重ねて表示できます。
    - **表示内容**:
        - **震度バッジ**: 「概要」「震度5弱」など、現在表示している情報のカテゴリを示します。
        - **メインテキスト**: 地震の概要や、震度ごとの地域名リストなどが大きな文字で2行にわたって表示されます。

### 2.2. 基本的な操作フロー

1.  **起動と選択**: アプリケーションを開くと、自動で最新の地震情報が読み込まれます。左のリストから表示したい地震をクリックします。
2.  **準備**: 画面下部の操作パネルで、表示秒数、ループ回数、切り替え効果（カット/スライド）を設定します。
3.  **再生**: 「▶」（再生）ボタンを押すと、自動ページ送りが開始されます。
    - 表示は「地震情報」という開始ページから始まります。
    - その後、概要 → 震源の深さ/M → 津波情報 → 各震度の地域リスト... の順で情報が自動で切り替わります。
4.  **終了**: 設定したループ回数が完了すると、「地震情報 おわり」というページが一定時間表示された後、自動的に表示がクリアされます。
5.  **手動操作**:
    - 自動再生中に「❚❚」（一時停止）を押すと、その場で停止します。
    - 自動再生中でないときは、「<」「>」ボタンで手動ページ送りが可能です。
    - 「リセット」ボタンを押すと、いつでも表示をクリアし、再生を初期状態に戻せます。

---

## 3. 詳細な仕様書

### 3.1. 全体アーキテクチャ
- **構成**: 単一HTMLファイル (`index.html`)
- **主要技術**: HTML, CSS, JavaScript (ES6)
- **外部ライブラリ**:
    - **Tailwind CSS**: UIのスタイリング（CDN経由）
    - **Google Fonts (M PLUS 1)**: 震度バッジのフォント（CDN経由）
- **データソース**: P2P地震情報 API v2

### 3.2. 主要機能仕様

| 機能 | 仕様 |
| :--- | :--- |
| **データ取得** | ・`https://api.p2pquake.net/v2/history?codes=551&limit=100` にアクセス。<br>・最大震度3以上の地震のみをフィルタリングして表示。 |
| **表示モード切替** | ・「市区町村別」と「観測点別」の2モード。<br>・詳細パネルと固定情報バーの両方に適用される。 |
| **固定情報バー** | ・画面下部に常時固定。<br>・左側に操作パネル、右側にクロマキー用グリーンバックの情報表示エリアを配置。 |
| **自動ページ送り** | ・`setInterval` を使用して実装。<br>・再生中は、地震リスト、API更新ボタン、表示モードトグルがロックされる。<br>・開始時に「地震情報」、終了時に「地震情報 おわり」ページを自動挿入。 |
| **ページ分割ロジック** | ・固定数ではなく、表示テキストの実際の描画幅を測定して動的にページを分割。<br>・`doesTextFitInTwoLines` 関数が、画面外のダミー要素で高さを測定し、2行に収まるか判定する。 |
| **ページ切替効果** | ・`updateFixedBarDisplay` 関数が制御。<br>・**カット**: コンテンツを即座に差し替え。<br>・**スライド**: CSSアニメーション（`@keyframes`）を使用。古いコンテンツをスライドアウトさせ、新しいコンテンツをスライドインさせる。 |

### 3.3. 主要な関数と役割

| 関数名 | 役割 |
| :--- | :--- |
| `fetchEarthquakeData` | APIから地震データを非同期で取得し、フィルタリングと重複排除を行う。 |
| `processEarthquake` | 取得した生データを、アプリケーションで使いやすい形式のオブジェクトに変換する。 |
| `displayEarthquakes` | 処理済み地震データ配列を元に、左側の地震一覧リストを生成・表示する。 |
| `displayEarthquakeDetails` | 選択された地震のデータを元に、右側の詳細パネルを生成・表示する。 |
| `updateFixedShindoBar` | 選択された地震のデータを元に、固定情報バーに表示する全ページ（ビュー）を構築する。 |
| `updateFixedBarDisplay` | 現在のページインデックスに基づき、固定情報バーの表示を更新する。ページ切替効果の実行も担当。 |
| `renderContent` | `updateFixedBarDisplay` から呼び出され、実際のコンテンツ描画（テキストやスタイルの設定）を行う。 |
| `startAutoplay` / `pauseAutoplay` | 自動ページ送りの開始・停止、および関連UIのロック/ロック解除を制御する。 |
| `setup***` 各種 | `setupToggle`, `setupResetButton` など、各UIコンポーネントのイベントリスナーを初期化時に設定する。 |

