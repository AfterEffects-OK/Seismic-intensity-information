## 1. 地震情報トラッカー アプリケーション操作マニュアル
このアプリケーションは、P2P地震情報APIを利用して直近の地震情報を取得し、配信画面などで利用しやすい形式で表示・操作するためのツールです。

1. 画面構成
画面は大きく分けて3つのエリアで構成されています。

地震一覧パネル（左側）: 最新の地震がリスト表示されます。
地震詳細パネル（右側）: 選択した地震の詳しい情報が表示されます。
固定情報バー（画面下部）: 配信画面向けに、選択した地震の情報を1ページずつ表示・操作するためのエリアです。
2. 基本操作
地震情報の確認
情報取得:

アプリケーションを開くと、自動的に最新の地震情報（最大震度3以上）が取得され、左側の「地震一覧」に表示されます。
一覧の右上にある [API更新] ボタンを押すと、手動で情報を更新できます。
詳細確認:

左側の「地震一覧」から確認したい地震をクリックします。
クリックされた地震がハイライトされ、右側の「地震詳細」パネルに震源地、マグニチュード、各地の震度などの詳しい情報が表示されます。
詳細表示の切り替え
右側の「地震詳細」パネルの上部にあるスイッチで、震度観測点の表示粒度を切り替えられます。

市区町村別: 同じ市区町村の複数の観測点は1つにまとめて表示します。（デフォルト）
観測点別: 全ての観測点名を個別に表示します。
3. 固定情報バー（配信画面向け機能）
画面下部の固定情報バーは、OBSなどの配信ソフトで取り込んで使用することを想定した機能です。選択した地震の情報を、テロップのように1ページずつ表示できます。

自動ページ送り（ループ再生）
地震情報を順番に自動で表示する機能です。

再生:

▶ (再生ボタン) をクリックすると、自動ページ送りが開始されます。
再生が始まると、ボタンは ■ (停止ボタン) に変わります。
再生中は、他の操作（地震の選択、表示モード切替など）はロックされます。
停止:

■ (停止ボタン) をクリックすると、自動ページ送りが停止し、ロックされていた操作が再び可能になります。
設定:

秒数: ページが切り替わるまでの秒数を設定します。（例: 10秒）
回数: 自動ページ送りを何回ループさせるか設定します。（1〜10回、または無限 ∞）
手動ページ送り
< (前へ): 前のページの情報に戻ります。
> (次へ): 次のページの情報に進みます。
表示のリセット
[リセット] ボタン: 自動ページ送りを停止し、情報バーの表示をクリアします。
表示効果の変更
トランジション選択: ページが切り替わる際のアニメーション効果を以下から選択できます。
カット: 瞬時に表示が切り替わります。
スライド: 次の情報が横からスライドして表示されます。
4. 設定
情報バーの左上にある キーボード型のアイコン をクリックすると、設定モーダルが開きます。

ショートカットキー設定
自動ページ送りの「再生/停止」を操作するためのキーボードショートカットを登録できます。

入力欄をクリックします。
設定したいキーの組み合わせ（例: Ctrl + Space）を押します。
[保存] ボタンを押して設定を完了します。
表示する最低震度の設定
情報バーのループ再生時に、どの震度から表示を開始するかを設定できます。

例えば「震度4以上」に設定すると、ループ再生では震度4以上の地域情報のみが表示されます（概況や津波情報は常に表示されます）。
このマニュアルが、アプリケーションをより効果的に活用するための一助となれば幸いです。
---

## 2. 詳細な仕様書

### 2.1. 全体アーキテクチャ
- **構成**: 単一HTMLファイル (`index.html`)
- **主要技術**: HTML, CSS, JavaScript (ES6)
- **外部ライブラリ**:
    - **Tailwind CSS**: UIのスタイリング（CDN経由）
    - **Google Fonts (M PLUS 1)**: 震度バッジのフォント（CDN経由）
- **データソース**: P2P地震情報 API v2

### 2.2. 主要機能仕様

| 機能 | 仕様 |
| :--- | :--- |
| **データ取得** | ・`https://api.p2pquake.net/v2/history?codes=551&limit=100` にアクセス。<br>・最大震度3以上の地震のみをフィルタリングして表示。 |
| **表示モード切替** | ・「市区町村別」と「観測点別」の2モード。<br>・詳細パネルと固定情報バーの両方に適用される。 |
| **固定情報バー** | ・画面下部に常時固定。<br>・左側に操作パネル、右側にクロマキー用グリーンバックの情報表示エリアを配置。 |
| **自動ページ送り** | ・`setInterval` を使用して実装。<br>・再生中は、地震リスト、API更新ボタン、表示モードトグルがロックされる。<br>・開始時に「地震情報」、終了時に「地震情報 おわり」ページを自動挿入。 |
| **ページ分割ロジック** | ・固定数ではなく、表示テキストの実際の描画幅を測定して動的にページを分割。<br>・`doesTextFitInTwoLines` 関数が、画面外のダミー要素で高さを測定し、2行に収まるか判定する。 |
| **ページ切替効果** | ・`updateFixedBarDisplay` 関数が制御。<br>・**カット**: コンテンツを即座に差し替え。<br>・**スライド**: CSSアニメーション（`@keyframes`）を使用。古いコンテンツをスライドアウトさせ、新しいコンテンツをスライドインさせる。 |

### 2.3. 主要な関数と役割

| 関数名 | 役割 |
| :--- | :--- |
| `fetchEarthquakeData` | APIから地震データを非同期で取得し、フィルタリングと重複排除を行う。 |
| `processEarthquake` | 取得した生データを、アプリケーションで使いやすい形式のオブジェクトに変換する。 |
| `displayEarthquakes` | 処理済み地震データ配列を元に、左側の地震一覧リストを生成・表示する。 |
| `displayEarthquakeDetails` | 選択された地震のデータを元に、右側の詳細パネルを生成・表示する。 |
| `updateFixedShindoBar` | 選択された地震のデータを元に、固定情報バーに表示する全ページ（ビュー）を構築する。 |
| `updateFixedBarDisplay` | 現在のページインデックスに基づき、固定情報バーの表示を更新する。ページ切替効果の実行も担当。 |
| `renderContent` | `updateFixedBarDisplay` から呼び出され、実際のコンテンツ描画（テキストやスタイルの設定）を行う。 |
| `startAutoplay` / `pauseAutoplay` | 自動ページ送りの開始・停止、および関連UIのロック/ロック解除を制御する。 |
| `setup***` 各種 | `setupToggle`, `setupResetButton` など、各UIコンポーネントのイベントリスナーを初期化時に設定する。 |

